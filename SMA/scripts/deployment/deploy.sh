#!/bin/bash
# ุณูุฑูุจุช ุงููุดุฑ ุงูุขูู

echo "๐ ุจุฏุก ุนูููุฉ ุงููุดุฑ..."

# ุงูุชุญูู ูู ุงูุจูุฆุฉ
if [ "$APP_ENV" != "production" ]; then
    echo "โ๏ธ ุชุญุฐูุฑ: ุงูุจูุฆุฉ ููุณุช production"
    read -p "ูู ุชุฑูุฏ ุงููุชุงุจุนุฉุ (y/n) " -n 1 -r
    echo
    if [[ ! $REPLY =~ ^[Yy]$ ]]; then
        exit 1
    fi
fi

# ุงููุณุฎ ุงูุงุญุชูุงุทู
echo "๐พ ุนูู ูุณุฎุฉ ุงุญุชูุงุทูุฉ..."
./scripts/maintenance/backup.sh

# ูุถุน ุงูุตูุงูุฉ
echo "๐ง ุชูุนูู ูุถุน ุงูุตูุงูุฉ..."
php artisan down --message="ูููู ุจุชุญุฏูุซ ุงููุธุงู" --retry=60

# ุชุญุฏูุซ ุงูููุฏ
echo "๐ฆ ุชุญุฏูุซ ุงูููุฏ..."
git pull origin main

# ุชุญุฏูุซ ุงูููุชุจุงุช
echo "๐ ุชุญุฏูุซ ุงูููุชุจุงุช..."
composer install --no-dev --optimize-autoloader

# ุชุดุบูู ุงููุฌุฑุงุช
echo "๐๏ธ ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช..."
php artisan migrate --force

# ุชุญุณูู ุงูุฃุฏุงุก
echo "โก ุชุญุณูู ุงูุฃุฏุงุก..."
./scripts/optimization/optimize.sh

# ุฅููุงุก ูุถุน ุงูุตูุงูุฉ
echo "โ ุฅููุงุก ูุถุน ุงูุตูุงูุฉ..."
php artisan up

echo "๐ ุชู ุงููุดุฑ ุจูุฌุงุญ!"
